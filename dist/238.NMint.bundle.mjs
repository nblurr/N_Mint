/*! For license information please see 238.NMint.bundle.mjs.LICENSE.txt */
(self.webpackChunkn_mint=self.webpackChunkn_mint||[]).push([[238],{5238:(e,t,n)=>{n.r(t),n.d(t,{AlchemyWebSocketProvider:()=>L});var r=n(2201),o=n(1683),i=n(7019),s=n(6954),a=n(2690),c=n(3226),u=n(7445),l=n(348).Process;function f(e,t,n){return t=v(t),function(e,t){if(t&&("object"==b(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,h()?Reflect.construct(t,n||[],v(e).constructor):t.apply(e,n))}function h(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(h=function(){return!!e})()}function p(e,t,n,r){var o=d(v(1&r?e.prototype:e),t,n);return 2&r?function(e){return o.apply(n,e)}:o}function d(){return d="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=function(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=v(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},d.apply(null,arguments)}function v(e){return v=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},v(e)}function y(e,t){return y=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},y(e,t)}function b(e){return b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},b(e)}function m(){m=function(){return t};var e,t={},n=Object.prototype,r=n.hasOwnProperty,o=Object.defineProperty||function(e,t,n){e[t]=n.value},i="function"==typeof Symbol?Symbol:{},s=i.iterator||"@@iterator",a=i.asyncIterator||"@@asyncIterator",c=i.toStringTag||"@@toStringTag";function u(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,n){return e[t]=n}}function l(e,t,n,r){var i=t&&t.prototype instanceof g?t:g,s=Object.create(i.prototype),a=new L(r||[]);return o(s,"_invoke",{value:T(e,n,a)}),s}function f(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",v="completed",y={};function g(){}function k(){}function w(){}var E={};u(E,s,(function(){return this}));var _=Object.getPrototypeOf,x=_&&_(_(A([])));x&&x!==n&&r.call(x,s)&&(E=x);var I=w.prototype=g.prototype=Object.create(E);function O(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function N(e,t){function n(o,i,s,a){var c=f(e[o],e,i);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==b(l)&&r.call(l,"__await")?t.resolve(l.__await).then((function(e){n("next",e,s,a)}),(function(e){n("throw",e,s,a)})):t.resolve(l).then((function(e){u.value=e,s(u)}),(function(e){return n("throw",e,s,a)}))}a(c.arg)}var i;o(this,"_invoke",{value:function(e,r){function o(){return new t((function(t,o){n(e,r,t,o)}))}return i=i?i.then(o,o):o()}})}function T(t,n,r){var o=h;return function(i,s){if(o===d)throw Error("Generator is already running");if(o===v){if("throw"===i)throw s;return{value:e,done:!0}}for(r.method=i,r.arg=s;;){var a=r.delegate;if(a){var c=S(a,r);if(c){if(c===y)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===h)throw o=v,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=d;var u=f(t,n,r);if("normal"===u.type){if(o=r.done?v:p,u.arg===y)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(o=v,r.method="throw",r.arg=u.arg)}}}function S(t,n){var r=n.method,o=t.iterator[r];if(o===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,S(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),y;var i=f(o,t.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,y;var s=i.arg;return s?s.done?(n[t.resultName]=s.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,y):s:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,y)}function C(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function B(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function L(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(C,this),this.reset(!0)}function A(t){if(t||""===t){var n=t[s];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function n(){for(;++o<t.length;)if(r.call(t,o))return n.value=t[o],n.done=!1,n;return n.value=e,n.done=!0,n};return i.next=i}}throw new TypeError(b(t)+" is not iterable")}return k.prototype=w,o(I,"constructor",{value:w,configurable:!0}),o(w,"constructor",{value:k,configurable:!0}),k.displayName=u(w,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===k||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,w):(e.__proto__=w,u(e,c,"GeneratorFunction")),e.prototype=Object.create(I),e},t.awrap=function(e){return{__await:e}},O(N.prototype),u(N.prototype,a,(function(){return this})),t.AsyncIterator=N,t.async=function(e,n,r,o,i){void 0===i&&(i=Promise);var s=new N(l(e,n,r,o),i);return t.isGeneratorFunction(n)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},O(I),u(I,c,"Generator"),u(I,s,(function(){return this})),u(I,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=A,L.prototype={constructor:L,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(B),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function o(r,o){return a.type="throw",a.arg=t,n.next=r,o&&(n.method="next",n.arg=e),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var s=this.tryEntries[i],a=s.completion;if("root"===s.tryLoc)return o("end");if(s.tryLoc<=this.prev){var c=r.call(s,"catchLoc"),u=r.call(s,"finallyLoc");if(c&&u){if(this.prev<s.catchLoc)return o(s.catchLoc,!0);if(this.prev<s.finallyLoc)return o(s.finallyLoc)}else if(c){if(this.prev<s.catchLoc)return o(s.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return o(s.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var s=i?i.completion:{};return s.type=e,s.arg=t,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),B(n),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;B(n)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:A(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),y}},t}function g(e){return function(e){if(Array.isArray(e))return w(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||k(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function k(e,t){if(e){if("string"==typeof e)return w(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?w(e,t):void 0}}function w(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function E(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,I(r.key),r)}}function x(e,t,n){return t&&_(e.prototype,t),n&&_(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function I(e){var t=function(e){if("object"!=b(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=b(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==b(t)?t:t+""}var O=function(){return x((function e(t){E(this,e),this.provider=t,this.maxBackfillBlocks=120}),[{key:"getNewHeadsBackfill",value:function(e,t,n){return(0,r._)(this,void 0,void 0,m().mark((function o(){var i,s,a,c,u;return m().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return B(e),o.next=3,this.getBlockNumber();case 3:if(i=o.sent,B(e),0!==t.length){o.next=7;break}return o.abrupt("return",this.getHeadEventsInRange(Math.max(n,i-this.maxBackfillBlocks)+1,i+1));case 7:if(s=(0,r.f)(t[t.length-1].number),a=i-this.maxBackfillBlocks+1,!(s<=a)){o.next=11;break}return o.abrupt("return",this.getHeadEventsInRange(a,i+1));case 11:return o.next=13,this.getReorgHeads(e,t);case 13:return c=o.sent,B(e),o.next=17,this.getHeadEventsInRange(s+1,i+1);case 17:return u=o.sent,B(e),o.abrupt("return",[].concat(g(c),g(u)));case 20:case"end":return o.stop()}}),o,this)})))}},{key:"getLogsBackfill",value:function(e,t,n,o){return(0,r._)(this,void 0,void 0,m().mark((function i(){var s,a,c,u,l,f,h;return m().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return B(e),i.next=3,this.getBlockNumber();case 3:if(s=i.sent,B(e),0!==n.length){i.next=7;break}return i.abrupt("return",this.getLogsInRange(t,Math.max(o,s-this.maxBackfillBlocks)+1,s+1));case 7:if(a=(0,r.f)(n[n.length-1].blockNumber),c=s-this.maxBackfillBlocks+1,!(a<c)){i.next=11;break}return i.abrupt("return",this.getLogsInRange(t,c,s+1));case 11:return i.next=13,this.getCommonAncestor(e,n);case 13:return u=i.sent,B(e),l=n.filter((function(e){return(0,r.f)(e.blockNumber)>u.blockNumber})).map((function(e){return Object.assign(Object.assign({},e),{removed:!0})})),f=u.blockNumber===Number.NEGATIVE_INFINITY?(0,r.f)(n[0].blockNumber):u.blockNumber,i.next=19,this.getLogsInRange(t,f,s+1);case 19:return h=(h=i.sent).filter((function(e){return e&&((0,r.f)(e.blockNumber)>u.blockNumber||(0,r.f)(e.logIndex)>u.logIndex)})),B(e),i.abrupt("return",[].concat(g(l),g(h)));case 23:case"end":return i.stop()}}),i,this)})))}},{key:"setMaxBackfillBlock",value:function(e){this.maxBackfillBlocks=e}},{key:"getBlockNumber",value:function(){return(0,r._)(this,void 0,void 0,m().mark((function e(){var t;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.provider.send("eth_blockNumber");case 2:return t=e.sent,e.abrupt("return",(0,r.f)(t));case 4:case"end":return e.stop()}}),e,this)})))}},{key:"getHeadEventsInRange",value:function(e,t){return(0,r._)(this,void 0,void 0,m().mark((function n(){var o,i,s;return m().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!(e>=t)){n.next=2;break}return n.abrupt("return",[]);case 2:for(o=[],i=e;i<t;i++)o.push({method:"eth_getBlockByNumber",params:[(0,r.t)(i),!1]});return n.next=6,this.provider.sendBatch(o);case 6:return s=n.sent,n.abrupt("return",s.map(N));case 8:case"end":return n.stop()}}),n,this)})))}},{key:"getReorgHeads",value:function(e,t){return(0,r._)(this,void 0,void 0,m().mark((function n(){var o,i,s,a;return m().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:o=[],i=t.length-1;case 2:if(!(i>=0)){n.next=14;break}return s=t[i],n.next=6,this.getBlockByNumber((0,r.f)(s.number));case 6:if(a=n.sent,B(e),s.hash!==a.hash){n.next=10;break}return n.abrupt("break",14);case 10:o.push(N(a));case 11:i--,n.next=2;break;case 14:return n.abrupt("return",o.reverse());case 15:case"end":return n.stop()}}),n,this)})))}},{key:"getBlockByNumber",value:function(e){return(0,r._)(this,void 0,void 0,m().mark((function t(){return m().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.provider.send("eth_getBlockByNumber",[(0,r.t)(e),!1]));case 1:case"end":return t.stop()}}),t,this)})))}},{key:"getCommonAncestor",value:function(e,t){return(0,r._)(this,void 0,void 0,m().mark((function n(){var o,i,s;return m().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.getBlockByNumber((0,r.f)(t[t.length-1].blockNumber));case 2:o=n.sent,B(e),i=t.length-1;case 5:if(!(i>=0)){n.next=16;break}if((s=t[i]).blockNumber===o.number){n.next=11;break}return n.next=10,this.getBlockByNumber((0,r.f)(s.blockNumber));case 10:o=n.sent;case 11:if(s.blockHash!==o.hash){n.next=13;break}return n.abrupt("return",{blockNumber:(0,r.f)(s.blockNumber),logIndex:(0,r.f)(s.logIndex)});case 13:i--,n.next=5;break;case 16:return n.abrupt("return",{blockNumber:Number.NEGATIVE_INFINITY,logIndex:Number.NEGATIVE_INFINITY});case 17:case"end":return n.stop()}}),n,this)})))}},{key:"getLogsInRange",value:function(e,t,n){return(0,r._)(this,void 0,void 0,m().mark((function o(){var i;return m().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(!(t>=n)){o.next=2;break}return o.abrupt("return",[]);case 2:return i=Object.assign(Object.assign({},e),{fromBlock:(0,r.t)(t),toBlock:(0,r.t)(n-1)}),o.abrupt("return",this.provider.send("eth_getLogs",[i]));case 4:case"end":return o.stop()}}),o,this)})))}}])}();function N(e){var t=Object.assign({},e);return delete t.totalDifficulty,delete t.transactions,delete t.uncles,t}function T(e){return S(e,(function(e){return"".concat(e.blockHash,"/").concat(e.logIndex)}))}function S(e,t){var n=new Set,r=[];return e.forEach((function(e){var o=t(e);n.has(o)||(n.add(o),r.push(e))})),r}var C=new Error("Cancelled");function B(e){if(e())throw C}var L=function(e){function t(e,i){var s,a;E(this,t);var h=c.AlchemyProvider.getApiKey(e.apiKey),p=c.AlchemyProvider.getAlchemyNetwork(e.network),d=c.AlchemyProvider.getAlchemyConnectionInfo(p,h,"wss"),v="alchemy-sdk-".concat(r.V),y=new o.A(null!==(a=e.url)&&void 0!==a?a:d.url,v,{wsConstructor:null!=i?i:void 0!==l&&null!=l&&null!=l.versions&&null!=l.versions.node?n(1170).w3cwebsocket:WebSocket}),b=r.E[p];return(s=f(this,t,[y,b]))._events=[],s.virtualSubscriptionsById=new Map,s.virtualIdsByPhysicalId=new Map,s.handleMessage=function(e){var t=JSON.parse(e.data);if(function(e){return!function(e){return Array.isArray(e)||"2.0"===e.jsonrpc&&void 0!==e.id}(e)}(t)){var n=t.params.subscription,r=s.virtualIdsByPhysicalId.get(n);if(r){var o=s.virtualSubscriptionsById.get(r);if("eth_subscribe"===o.method)switch(o.params[0]){case"newHeads":var i=o,a=t,c=i.isBackfilling,u=i.backfillBuffer,l=a.params.result;c?function(e,t){M(e,t,H)}(u,l):n!==r?s.emitAndRememberEvent(r,l,H):s.rememberEvent(r,l,H);break;case"logs":var f=o,h=t,p=f.isBackfilling,d=f.backfillBuffer,v=h.params.result;p?function(e,t){M(e,t,D)}(d,v):r!==n?s.emitAndRememberEvent(r,v,D):s.rememberEvent(r,v,D);break;default:if(n!==r){var y=t.params.result;s.emitEvent(r,y)}}}}},s.handleReopen=function(){s.virtualIdsByPhysicalId.clear();var e,t=(e=!1,{cancel:function(){return e=!0},isCancelled:function(){return e}}),n=t.cancel,o=t.isCancelled;s.cancelBackfill=n;var i,a=function(e){var t="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=k(e))){t&&(e=t);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,s=!1;return{s:function(){t=t.call(e)},n:function(){var e=t.next();return i=e.done,e},e:function(e){s=!0,o=e},f:function(){try{i||null==t.return||t.return()}finally{if(s)throw o}}}}(s.virtualSubscriptionsById.values());try{var c=function(){var e=i.value;(0,r._)(s,void 0,void 0,m().mark((function t(){return m().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.resubscribeAndBackfill(o,e);case 3:t.next=8;break;case 5:t.prev=5,t.t0=t.catch(0),o()||u.error('Error while backfilling "'.concat(e.params[0],'" subscription. Some events may be missing.'),t.t0);case 8:case"end":return t.stop()}}),t,this,[[0,5]])})))};for(a.s();!(i=a.n()).done;)c()}catch(e){a.e(e)}finally{a.f()}s.startHeartbeat()},s.stopHeartbeatAndBackfill=function(){null!=s.heartbeatIntervalId&&(clearInterval(s.heartbeatIntervalId),s.heartbeatIntervalId=void 0),s.cancelBackfill()},s.apiKey=h,s.backfiller=new O(s),s.addSocketListeners(),s.startHeartbeat(),s.cancelBackfill=r.n,s}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&y(e,t)}(t,e),x(t,[{key:"on",value:function(e,t){return this._addEventListener(e,t,!1)}},{key:"once",value:function(e,t){return this._addEventListener(e,t,!0)}},{key:"off",value:function(e,n){return(0,r.i)(e)?this._off(e,n):p(t,"off",this,3)([e,n])}},{key:"removeAllListeners",value:function(e){return void 0!==e&&(0,r.i)(e)?this._removeAllListeners(e):p(t,"removeAllListeners",this,3)([e])}},{key:"listenerCount",value:function(e){return void 0!==e&&(0,r.i)(e)?this._listenerCount(e):p(t,"listenerCount",this,3)([e])}},{key:"listeners",value:function(e){return void 0!==e&&(0,r.i)(e)?this._listeners(e):p(t,"listeners",this,3)([e])}},{key:"_addEventListener",value:function(e,n,o){if((0,r.i)(e)){(0,r.v)(e);var i=new r.c((0,r.e)(e),n,o);return this._events.push(i),this._startEvent(i),this}return p(t,"_addEventListener",this,3)([e,n,o])}},{key:"_startEvent",value:function(e){[].concat(g(r.A),["block","filter"]).includes(e.type)?this.customStartEvent(e):p(t,"_startEvent",this,3)([e])}},{key:"_subscribe",value:function(e,t,n,o){return(0,r._)(this,void 0,void 0,m().mark((function r(){var i,s,a,c,u=this;return m().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return i=this._subIds[e],r.next=3,this.getBlockNumber();case 3:return s=r.sent,null==i&&(i=Promise.all(t).then((function(e){return u.send("eth_subscribe",e)})),this._subIds[e]=i),r.next=7,i;case 7:return a=r.sent,r.next=10,Promise.all(t);case 10:c=r.sent,this.virtualSubscriptionsById.set(a,{event:o,method:"eth_subscribe",params:c,startingBlockNumber:s,virtualId:a,physicalId:a,sentEvents:[],isBackfilling:!1,backfillBuffer:[]}),this.virtualIdsByPhysicalId.set(a,a),this._subs[a]={tag:e,processFunc:n};case 14:case"end":return r.stop()}}),r,this)})))}},{key:"emit",value:function(e){for(var n=this,o=arguments.length,i=new Array(o>1?o-1:0),s=1;s<o;s++)i[s-1]=arguments[s];if((0,r.i)(e)){var a=!1,c=[],u=(0,r.e)(e);return this._events=this._events.filter((function(e){return e.tag!==u||(setTimeout((function(){e.listener.apply(n,i)}),0),a=!0,!e.once||(c.push(e),!1))})),c.forEach((function(e){n._stopEvent(e)})),a}return p(t,"emit",this,3)([e].concat(i))}},{key:"sendBatch",value:function(e){return(0,r._)(this,void 0,void 0,m().mark((function t(){var n,r;return m().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=0,r=e.map((function(e){return{method:e.method,params:e.params,jsonrpc:"2.0",id:"alchemy-sdk:".concat(n++)}})),t.abrupt("return",this.sendBatchConcurrently(r));case 3:case"end":return t.stop()}}),t,this)})))}},{key:"destroy",value:function(){return this.removeSocketListeners(),this.stopHeartbeatAndBackfill(),p(t,"destroy",this,3)([])}},{key:"isCommunityResource",value:function(){return this.apiKey===r.D}},{key:"_stopEvent",value:function(e){var t=this,n=e.tag;if(r.A.includes(e.type)){if(this._events.filter((function(e){return r.A.includes(e.type)})).length)return}else if("tx"===e.type){if(this._events.filter((function(e){return"tx"===e.type})).length)return;n="tx"}else if(this.listenerCount(e.event))return;var o=this._subIds[n];o&&(delete this._subIds[n],o.then((function(e){t._subs[e]&&(delete t._subs[e],t.send("eth_unsubscribe",[e]))})))}},{key:"addSocketListeners",value:function(){this._websocket.addEventListener("message",this.handleMessage),this._websocket.addEventListener("reopen",this.handleReopen),this._websocket.addEventListener("down",this.stopHeartbeatAndBackfill)}},{key:"removeSocketListeners",value:function(){this._websocket.removeEventListener("message",this.handleMessage),this._websocket.removeEventListener("reopen",this.handleReopen),this._websocket.removeEventListener("down",this.stopHeartbeatAndBackfill)}},{key:"resubscribeAndBackfill",value:function(e,t){return(0,r._)(this,void 0,void 0,m().mark((function n(){var r,o,i,s,a,c,u,l,f,h,p=this;return m().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=t.virtualId,o=t.method,i=t.params,s=t.sentEvents,a=t.backfillBuffer,c=t.startingBlockNumber,t.isBackfilling=!0,a.length=0,n.prev=3,n.next=6,this.send(o,i);case 6:u=n.sent,B(e),t.physicalId=u,this.virtualIdsByPhysicalId.set(u,r),n.t0=i[0],n.next="newHeads"===n.t0?13:"logs"===n.t0?20:28;break;case 13:return n.next=15,j((function(){return G(p.backfiller.getNewHeadsBackfill(e,s,c),6e4)}),5,(function(){return!e()}));case 15:return l=n.sent,B(e),(d=[].concat(g(l),g(a)),S(d,(function(e){return e.hash}))).forEach((function(e){return p.emitNewHeadsEvent(r,e)})),n.abrupt("break",29);case 20:return f=i[1]||{},n.next=23,j((function(){return G(p.backfiller.getLogsBackfill(e,f,s,c),6e4)}),5,(function(){return!e()}));case 23:return h=n.sent,B(e),T([].concat(g(h),g(a))).forEach((function(e){return p.emitLogsEvent(r,e)})),n.abrupt("break",29);case 28:return n.abrupt("break",29);case 29:return n.prev=29,t.isBackfilling=!1,a.length=0,n.finish(29);case 33:case"end":return n.stop()}var d}),n,this,[[3,,29,33]])})))}},{key:"emitNewHeadsEvent",value:function(e,t){this.emitAndRememberEvent(e,t,H)}},{key:"emitLogsEvent",value:function(e,t){this.emitAndRememberEvent(e,t,D)}},{key:"emitAndRememberEvent",value:function(e,t,n){this.rememberEvent(e,t,n),this.emitEvent(e,t)}},{key:"emitEvent",value:function(e,t){var n=this.virtualSubscriptionsById.get(e);n&&this.emitGenericEvent(n,t)}},{key:"rememberEvent",value:function(e,t,n){var r=this.virtualSubscriptionsById.get(e);r&&M(r.sentEvents,Object.assign({},t),n)}},{key:"emitGenericEvent",value:function(e,t){this.emitProcessFn(e.event)(t)}},{key:"startHeartbeat",value:function(){var e=this;null==this.heartbeatIntervalId&&(this.heartbeatIntervalId=setInterval((function(){return(0,r._)(e,void 0,void 0,m().mark((function e(){return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,G(this.send("net_version"),1e4);case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),this._websocket.reconnect();case 8:case"end":return e.stop()}}),e,this,[[0,5]])})))}),3e4))}},{key:"sendBatchConcurrently",value:function(e){return(0,r._)(this,void 0,void 0,m().mark((function t(){var n=this;return m().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Promise.all(e.map((function(e){return n.send(e.method,e.params)}))));case 1:case"end":return t.stop()}}),t)})))}},{key:"customStartEvent",value:function(e){if(e.type===r.h){var t=e.fromAddress,n=e.toAddress,o=e.hashesOnly;this._subscribe(e.tag,[r.j.PENDING_TRANSACTIONS,{fromAddress:t,toAddress:n,hashesOnly:o}],this.emitProcessFn(e),e)}else if(e.type===r.k){var i=e.addresses,s=e.includeRemoved,a=e.hashesOnly;this._subscribe(e.tag,[r.j.MINED_TRANSACTIONS,{addresses:i,includeRemoved:s,hashesOnly:a}],this.emitProcessFn(e),e)}else"block"===e.type?this._subscribe("block",["newHeads"],this.emitProcessFn(e),e):"filter"===e.type&&this._subscribe(e.tag,["logs",this._getFilter(e.filter)],this.emitProcessFn(e),e)}},{key:"emitProcessFn",value:function(e){var t=this;switch(e.type){case r.h:return function(n){return t.emit({method:r.j.PENDING_TRANSACTIONS,fromAddress:e.fromAddress,toAddress:e.toAddress,hashesOnly:e.hashesOnly},n)};case r.k:return function(n){return t.emit({method:r.j.MINED_TRANSACTIONS,addresses:e.addresses,includeRemoved:e.includeRemoved,hashesOnly:e.hashesOnly},n)};case"block":return function(e){var n=i.gH.from(e.number).toNumber();t._emitted.block=n,t.emit("block",n)};case"filter":return function(n){null==n.removed&&(n.removed=!1),t.emit(e.filter,t.formatter.filterLog(n))};default:throw new Error("Invalid event type to `emitProcessFn()`")}}},{key:"_off",value:function(e,t){var n=this;if(null==t)return this.removeAllListeners(e);var o=[],i=!1,s=(0,r.e)(e);return this._events=this._events.filter((function(e){return e.tag!==s||e.listener!=t||!!i||(i=!0,o.push(e),!1)})),o.forEach((function(e){n._stopEvent(e)})),this}},{key:"_removeAllListeners",value:function(e){var t=this,n=[];if(null==e)n=this._events,this._events=[];else{var o=(0,r.e)(e);this._events=this._events.filter((function(e){return e.tag!==o||(n.push(e),!1)}))}return n.forEach((function(e){t._stopEvent(e)})),this}},{key:"_listenerCount",value:function(e){if(!e)return this._events.length;var t=(0,r.e)(e);return this._events.filter((function(e){return e.tag===t})).length}},{key:"_listeners",value:function(e){if(null==e)return this._events.map((function(e){return e.listener}));var t=(0,r.e)(e);return this._events.filter((function(e){return e.tag===t})).map((function(e){return e.listener}))}}],[{key:"getNetwork",value:function(e){return"string"==typeof e&&e in r.C?r.C[e]:(0,s.N)(e)}}])}(a.f),A=1e3,P=2,R=3e4;function j(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){return!0};return(0,r._)(this,void 0,void 0,m().mark((function r(){var o,i;return m().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:o=0,i=0;case 2:return r.prev=3,r.next=6,e();case 6:return r.abrupt("return",r.sent);case 9:if(r.prev=9,r.t0=r.catch(3),!(++i>=t)&&n(r.t0)){r.next=14;break}throw r.t0;case 14:return r.next=16,F(o);case 16:if(n(r.t0)){r.next=18;break}throw r.t0;case 18:o=0===o?A:Math.min(R,P*o);case 19:r.next=2;break;case 21:case"end":return r.stop()}}),r,null,[[3,9]])})))}function F(e){return new Promise((function(t){return setTimeout(t,e)}))}function G(e,t){return Promise.race([e,new Promise((function(e,n){return setTimeout((function(){return n(new Error("Timeout"))}),t)}))])}function H(e){return(0,r.f)(e.number)}function D(e){return(0,r.f)(e.blockNumber)}function M(e,t,n){var r=n(t),o=e.findIndex((function(e){return n(e)>r-10}));-1===o?e.length=0:e.splice(0,o),e.push(t)}},7869:e=>{function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(e)}var n=function(){if("object"===("undefined"==typeof self?"undefined":t(self))&&self)return self;if("object"===("undefined"==typeof window?"undefined":t(window))&&window)return window;throw new Error("Unable to resolve global `this`")};e.exports=function(){if(this)return this;if("object"===("undefined"==typeof globalThis?"undefined":t(globalThis))&&globalThis)return globalThis;try{Object.defineProperty(Object.prototype,"__global__",{get:function(){return this},configurable:!0})}catch(e){return n()}try{return __global__||n()}finally{delete Object.prototype.__global__}}()},1683:(e,t,n)=>{var r=n(7445),o=function(){function e(t,n,r){if(void 0===r&&(r={}),this.url=t,this.onclose=null,this.onerror=null,this.onmessage=null,this.onopen=null,this.ondown=null,this.onreopen=null,this.CONNECTING=e.CONNECTING,this.OPEN=e.OPEN,this.CLOSING=e.CLOSING,this.CLOSED=e.CLOSED,this.hasBeenOpened=!1,this.isClosed=!1,this.messageBuffer=[],this.nextRetryTime=0,this.reconnectCount=0,this.lastKnownExtensions="",this.lastKnownProtocol="",this.listeners={},null==n||"string"==typeof n||Array.isArray(n)?this.protocols=n:r=n,this.options=i(r),!this.options.wsConstructor){if("undefined"==typeof WebSocket)throw new Error("WebSocket not present in global scope and no wsConstructor option was provided.");this.options.wsConstructor=WebSocket}this.openNewWebSocket()}return Object.defineProperty(e.prototype,"binaryType",{get:function(){return this.binaryTypeInternal||"blob"},set:function(e){this.binaryTypeInternal=e,this.ws&&(this.ws.binaryType=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bufferedAmount",{get:function(){var e=this.ws?this.ws.bufferedAmount:0,t=!1;return this.messageBuffer.forEach((function(n){var r=function(e){return"string"==typeof e?2*e.length:e instanceof ArrayBuffer?e.byteLength:e instanceof Blob?e.size:void 0}(n);null!=r?e+=r:t=!0})),t&&this.debugLog("Some buffered data had unknown length. bufferedAmount() return value may be below the correct amount."),e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"extensions",{get:function(){return this.ws?this.ws.extensions:this.lastKnownExtensions},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"protocol",{get:function(){return this.ws?this.ws.protocol:this.lastKnownProtocol},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"readyState",{get:function(){return this.isClosed?e.CLOSED:e.OPEN},enumerable:!0,configurable:!0}),e.prototype.close=function(e,t){this.disposeSocket(e,t),this.shutdown(),this.debugLog("WebSocket permanently closed by client.")},e.prototype.send=function(e){if(this.isClosed)throw new Error("WebSocket is already in CLOSING or CLOSED state.");this.ws&&this.ws.readyState===this.OPEN?this.ws.send(e):this.messageBuffer.push(e)},e.prototype.reconnect=function(){if(this.isClosed)throw new Error("Cannot call reconnect() on socket which is permanently closed.");this.disposeSocket(1e3,"Client requested reconnect."),this.handleClose(void 0)},e.prototype.addEventListener=function(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)},e.prototype.dispatchEvent=function(e){return this.dispatchEventOfType(e.type,e)},e.prototype.removeEventListener=function(e,t){this.listeners[e]&&(this.listeners[e]=this.listeners[e].filter((function(e){return e!==t})))},e.prototype.openNewWebSocket=function(){var e=this;if(!this.isClosed){var t=this.options,n=t.connectTimeout,r=t.wsConstructor;this.debugLog("Opening new WebSocket to "+this.url+".");var o=new r(this.url,this.protocols);o.onclose=function(t){return e.handleClose(t)},o.onerror=function(t){return e.handleError(t)},o.onmessage=function(t){return e.handleMessage(t)},o.onopen=function(t){return e.handleOpen(t)},this.connectTimeoutId=setTimeout((function(){e.clearConnectTimeout(),e.disposeSocket(),e.handleClose(void 0)}),n),this.ws=o}},e.prototype.handleOpen=function(e){var t=this;if(this.ws&&!this.isClosed){var n=this.options.allClearResetTime;this.debugLog("WebSocket opened."),null!=this.binaryTypeInternal?this.ws.binaryType=this.binaryTypeInternal:this.binaryTypeInternal=this.ws.binaryType,this.clearConnectTimeout(),this.hasBeenOpened?this.dispatchEventOfType("reopen",e):(this.dispatchEventOfType("open",e),this.hasBeenOpened=!0),this.messageBuffer.forEach((function(e){return t.send(e)})),this.messageBuffer=[],this.allClearTimeoutId=setTimeout((function(){t.clearAllClearTimeout(),t.nextRetryTime=0,t.reconnectCount=0;var e=n/1e3|0;t.debugLog("WebSocket remained open for "+e+" seconds. Resetting retry time and count.")}),n)}},e.prototype.handleMessage=function(e){this.isClosed||this.dispatchEventOfType("message",e)},e.prototype.handleClose=function(e){var t=this;if(!this.isClosed){var n=this.options,r=n.maxReconnectAttempts,o=n.shouldReconnect;if(this.clearConnectTimeout(),this.clearAllClearTimeout(),this.ws&&(this.lastKnownExtensions=this.ws.extensions,this.lastKnownProtocol=this.ws.protocol,this.disposeSocket()),this.dispatchEventOfType("down",e),this.reconnectCount>=r)this.stopReconnecting(e,this.getTooManyFailedReconnectsMessage());else{var i=!e||o(e);"boolean"==typeof i?this.handleWillReconnect(i,e,"Provided shouldReconnect() returned false. Closing permanently."):i.then((function(n){t.isClosed||t.handleWillReconnect(n,e,"Provided shouldReconnect() resolved to false. Closing permanently.")}))}}},e.prototype.handleError=function(e){this.dispatchEventOfType("error",e),this.debugLog("WebSocket encountered an error.")},e.prototype.handleWillReconnect=function(e,t,n){e?this.reestablishConnection():this.stopReconnecting(t,n)},e.prototype.reestablishConnection=function(){var e=this,t=this.options,n=t.minReconnectDelay,r=t.maxReconnectDelay,o=t.reconnectBackoffFactor;this.reconnectCount++;var i=this.nextRetryTime;this.nextRetryTime=Math.max(n,Math.min(this.nextRetryTime*o,r)),setTimeout((function(){return e.openNewWebSocket()}),i);var s=i/1e3|0;this.debugLog("WebSocket was closed. Re-opening in "+s+" seconds.")},e.prototype.stopReconnecting=function(e,t){this.debugLog(t),this.shutdown(),e&&this.dispatchEventOfType("close",e)},e.prototype.shutdown=function(){this.isClosed=!0,this.clearAllTimeouts(),this.messageBuffer=[],this.disposeSocket()},e.prototype.disposeSocket=function(e,t){this.ws&&(this.ws.onerror=s,this.ws.onclose=s,this.ws.onmessage=s,this.ws.onopen=s,this.ws.close(e,t),this.ws=void 0)},e.prototype.clearAllTimeouts=function(){this.clearConnectTimeout(),this.clearAllClearTimeout()},e.prototype.clearConnectTimeout=function(){null!=this.connectTimeoutId&&(clearTimeout(this.connectTimeoutId),this.connectTimeoutId=void 0)},e.prototype.clearAllClearTimeout=function(){null!=this.allClearTimeoutId&&(clearTimeout(this.allClearTimeoutId),this.allClearTimeoutId=void 0)},e.prototype.dispatchEventOfType=function(e,t){var n=this;switch(e){case"close":this.onclose&&this.onclose(t);break;case"error":this.onerror&&this.onerror(t);break;case"message":this.onmessage&&this.onmessage(t);break;case"open":this.onopen&&this.onopen(t);break;case"down":this.ondown&&this.ondown(t);break;case"reopen":this.onreopen&&this.onreopen(t)}return e in this.listeners&&this.listeners[e].slice().forEach((function(e){return n.callListener(e,t)})),!t||!t.defaultPrevented},e.prototype.callListener=function(e,t){"function"==typeof e?e.call(this,t):e.handleEvent.call(this,t)},e.prototype.debugLog=function(e){this.options.debug&&r.log(e)},e.prototype.getTooManyFailedReconnectsMessage=function(){var e,t=this.options.maxReconnectAttempts;return"Failed to reconnect after "+t+" "+(e="attempt",(1===t?e:e+"s")+". Closing permanently.")},e.DEFAULT_OPTIONS={allClearResetTime:5e3,connectTimeout:5e3,debug:!1,minReconnectDelay:1e3,maxReconnectDelay:3e4,maxReconnectAttempts:Number.POSITIVE_INFINITY,reconnectBackoffFactor:1.5,shouldReconnect:function(){return!0},wsConstructor:void 0},e.CONNECTING=0,e.OPEN=1,e.CLOSING=2,e.CLOSED=3,e}();function i(e){var t={};return Object.keys(o.DEFAULT_OPTIONS).forEach((function(n){var r=e[n];t[n]=void 0===r?o.DEFAULT_OPTIONS[n]:r})),t}function s(){}t.A=o},1170:(e,t,n)=>{function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}var o;if("object"===("undefined"==typeof globalThis?"undefined":r(globalThis)))o=globalThis;else try{o=n(7869)}catch(e){}finally{if(o||"undefined"==typeof window||(o=window),!o)throw new Error("Could not determine global this")}var i=o.WebSocket||o.MozWebSocket,s=n(4118);function a(e,t){return t?new i(e,t):new i(e)}i&&["CONNECTING","OPEN","CLOSING","CLOSED"].forEach((function(e){Object.defineProperty(a,e,{get:function(){return i[e]}})})),e.exports={w3cwebsocket:i?a:null,version:s}},4118:(e,t,n)=>{e.exports=n(9003).version},9003:e=>{e.exports={version:"1.0.35"}}}]);